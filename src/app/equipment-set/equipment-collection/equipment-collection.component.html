<div class="collection">
  <div class="header">
    <mat-icon>list</mat-icon>
    <span class="name">{{collection?.name}}</span>
    <button class="move" mat-icon-button (click)="moveCollection()">
      <mat-icon>swap_vert</mat-icon>
    </button>
    <a mat-icon-button [routerLink]="['/equipment-set', setId$ | async, 'edit-collection', collection.id]">
      <mat-icon>edit</mat-icon>
    </a>
  </div>
  <div class="limits" *ngIf="collection.limits">
    <div class="limits-header">
      <h4>Limits</h4>
    </div>
    <ng-container *ngIf="collection.limits as limits; else noLimitsSet">
      <equip-limits-view [limits]="limits" [limitDefinitions]="limitDefinitions$ | async"></equip-limits-view>
    </ng-container>
    <ng-template #noLimitsSet>
      This collection has no custom limits set
    </ng-template>
  </div>
  <div class="totals" *ngIf="(selectedVariant$ | async).totals as values">
    <h4>Totals</h4>
    <equip-equipment-totals [values]="values" [totals]="totals" [showTotals]="true" [setLimits]="setLimits$ | async"></equip-equipment-totals>
  </div>
  <ng-container *ngIf="entries$ | async as entries">
    <div class="entries" *ngIf="entries.ids.length">
      <h4>Entries</h4>
      <ng-container
        *ngFor="let variantEntry of (selectedVariant$ | async).entries; trackBy: variantEntryId; let index = index;">
        <ng-container *ngIf="entries.entities[variantEntry.entryId] as entry">
          <div class="drop-target" @move *ngIf="moveMode && index < moveIndex" (click)="dropTo(index)">
            <mat-icon>input</mat-icon>
          </div>
          <equip-equipment-entry
            class="equipment-entry"
            [class.move]="entry?.id === this.moveMode?.entry?.id"
            [entry]="entry"
            [totals]="variantEntry.totals"
            [collection]="collection"
            [editMode]="editMode && !moveMode"
            [selectedItemId]="variantEntry.itemId"
            [moving]="!!moveMode"
            (move)="move(entry, index)"></equip-equipment-entry>
          <div class="drop-target" @move *ngIf="moveMode && index > moveIndex" (click)="dropTo(index)">
            <mat-icon>input</mat-icon>
          </div>
        </ng-container>
      </ng-container>
    </div>
  </ng-container>
</div>
