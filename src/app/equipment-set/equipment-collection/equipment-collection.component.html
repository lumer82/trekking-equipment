<div class="collection">
  <div class="header">
    <mat-icon>list</mat-icon>
    <ng-container *ngIf="editMode; else noEditHeader">
      <mat-input-container class="name">
        <input type="text" matInput placeholder="Name" [value]="collection?.name" [formControl]="nameForm">
      </mat-input-container>
      <button class="delete" mat-icon-button (click)="delete()">
        <mat-icon>delete</mat-icon>
      </button>
    </ng-container>
    <ng-template #noEditHeader>
      <span class="name">{{collection?.name}}</span>
    </ng-template>
    <button mat-icon-button (click)="toggleEditMode()"><mat-icon>{{ editMode ? 'check' : 'edit' }}</mat-icon></button>
  </div>
  <ng-container *ngIf="entries$ | async as entries">
    <ng-container *ngFor="let variantEntry of (selectedVariant$ | async).entries; trackBy: variantEntryId; let index = index;">
      <ng-container *ngIf="entries.entities[variantEntry.entryId] as entry">
        <div class="drop-target" @move *ngIf="moveMode && index < moveIndex" (click)="dropTo(index)" ><mat-icon>input</mat-icon></div>
        <equip-equipment-entry
          class="equipment-entry"
          [class.move]="entry?.id === this.moveMode?.entry?.id"
          [entry]="entry"
          [totals]="variantEntry.totals"
          [collection]="collection"
          [editMode]="editMode && !moveMode"
          [selectedItemId]="variantEntry.itemId"
          [moving]="!!moveMode"
          (move)="move(entry, index)"></equip-equipment-entry>
        <div class="drop-target" @move *ngIf="moveMode && index > moveIndex" (click)="dropTo(index)"><mat-icon>input</mat-icon></div>
      </ng-container>
    </ng-container>
  </ng-container>
  <div class="new-entry" *ngIf="editMode">
    <mat-icon>create_new_folder</mat-icon>
    <mat-input-container>
      <input type="text" matInput placeholder="Name" (keyup.enter)="addEntry(newEntryName)" #newEntryName>
    </mat-input-container>
    <button mat-icon-button (click)="addEntry(newEntryName)"><mat-icon>add</mat-icon></button>
  </div>
</div>
